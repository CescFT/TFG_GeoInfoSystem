<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mòdul estadístic</title>
    {% load static %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        /* Style the header with a grey background and some padding */
    .header {
      overflow: hidden;
      background-color: #f1f1f1;
      padding: 20px 10px;
    }

    /* Style the header links */
    .header a {
      float: left;
      color: black;
      text-align: center;
      padding: 12px;
      text-decoration: none;
      font-size: 18px;
      line-height: 25px;
      border-radius: 4px;
    }

    /* Style the logo link (notice that we set the same value of line-height and font-size to prevent the header to increase when the font gets bigger */
    .header a.logo {
      font-size: 25px;
      font-weight: bold;
    }

    /* Change the background color on mouse-over */
    .header a:hover {
      background-color: #ddd;
      color: black;
    }

    /* Style the active/current link*/
    .header a.active {
      background-color: dodgerblue;
      color: white;
    }

    /* Float the link section to the right */
    .header-right {
      float: right;
    }

    /* Add media queries for responsiveness - when the screen is 500px wide or less, stack the links on top of each other */
    @media screen and (max-width: 500px) {
      .header a {
        float: none;
        display: block;
        text-align: left;
      }
      .header-right {
        float: none;
      }
    }
    #map {
        height: 400px;  /* The height is 400 pixels */
        width: 100%;  /* The width is the width of the web page */
       }

    .same-line-block-elem1{
        display: inline-block;
        margin-right: 10px;
    }
    .same-line-block-elem2{
        display: inline-block;
    }

    .parent #popup{
        display: none;
    }
    .parent:hover #popup{
        display: block;
    }
/*graella*/
table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
.checked{
    color:gold;
}
.unchecked{
    color: black;
}
    </style>


</head>
<body onload="inicialitzacioEstadistiques()">
    <div class="header">
        <a href="/" class="logo active"><i class="fa fa-home" aria-hidden="true"></i> Sistema d'Informació Geogràfica</a>
        <div class="header-right">
            <a id="pgRand"><i class="fa fa-info" aria-hidden="true"></i> Informació aleatòria d'un local</a>
            {% if user.is_staff and user.is_superuser %}
                <a href="/v1/geoInfoSystem/nouPunt/"><i class="fa fa-magic"></i> Afegir nous punts</a>
            {% endif %}
            {% if user.is_authenticated %}
                <a href="/v1/geoInfoSystem/el_meu_espai/"><i class="fa fa-user"></i> {{ user.username }}</a>
                <a href="/v1/geoInfoSystem/tancar_sessio/"><i class="fa fa-sign-out"></i> Tanca la sessió</a>
            {% else %}
                <a href="/v1/geoInfoSystem/registrar_nou_usuari/"><i class="fa fa-sign-in"></i> Registra't</a>
                <a href="/v1/geoInfoSystem/inicia_sessio/"><i class="fa fa-check"></i> Inicia sessió</a>
            {% endif %}
        </div>
    </div>
    <br>
    <h1 class="text-center">Estadístiques</h1>
    <hr>
    <div class="container">
        <button type="button" class="btn btn-secondary" onclick="showInstructions()" ><img height="22px" src="https://img.icons8.com/dotty/80/000000/user-manual.png"/> Mostrar informació</button>
    </div>
    <div class="container" id="instruccions" hidden>
        <div class="card card-body">
            <h2><img height="70px" src="https://img.icons8.com/dotty/80/000000/user-manual.png"/> Informació sobre el mòdul estadístic</h2>
            <ol>
                <li><b>Aplicar els filtres:</b>
                    <ul>
                        <li><b><i>Provincia:</i></b> En aquest desplegable es selecciona la província per a que els pobles apareixin els que hi ha en aquesta província específicament.</li>
                        <li><b><i>Ciutat:</i></b> Un cop s'ha escollit la província desitjanda, en aquest desplegable es selecciona la població desitjada.</li>
                        <li><b><i>Tipus:</i></b> S'escull la categoria o tipus de local que es vol.</li>
                        <li><b><i>Actiu:</i></b> Apretant el botó permetem que el servidor interpreti que el/s locals que es cerquen són actius. En cas que no s'apreti, s'interpretarà que són no actius.</li>
                    </ul>
                </li>
                <li><b>Visualització dels resultats:</b>
                    Un cop aplicats els filtres que es creguin convenients, el sistema GIS ja té la solució a tot el que es demana. Simplement, s'ha d'anar navegant amb la botonera de la part inferior i es poden anar visualitzant les respostes.<br>
                    Cada botó obté una solució diferent, aquests són:
                    <ul>
                        <li><b><i>Botó "Consulta Actual":</i></b> Conté el resultat d'haver aplicat els filtres establerts en la pestanya de fer les consultes.</li>
                        <li><b><i>Botó "Locals mateixa ciutat":</i></b> Conté tots els locals de la mateixa ciutat, tant actius com no actius.</li>
                        <li><b><i>Botó "Locals mateixa categoria":</i></b> Conté el resultat d'haver negat l'actiu donat, però mantenint la mateixa categoria.</li>
                        <li><b><i>Botó "Locals diferent categoria":</i></b> Conté el resultat de mantenir l'actiu i el poble, però diferent categoria.</li>
                        <li><b><i>Botó "Locals altres pobles i categoria actual":</i></b> Conté el resultat de mantenir l'actiu i la categoria però canviant el poble.</li>
                        <li><b><i>Botó "Resulta contrari":</i></b> Conté el resultat d'haver negat tots els valors d'entrada.</li>
                        <li><b><i>Botó "Consultar tota la informació":</i></b> Independentment dels filtres que hi hagi, en aquesta pestanya hi ha tots els locals que hi ha en el sistema GIS.</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>
    <br>

    <div class="container" id="estadistiques">
        <div class="row">
            <div style="display: block; margin-left: auto; margin-right: auto; width: 40%;" class="card card-body">
                <h2><img src="https://img.icons8.com/ios/50/000000/statistics.png"/> Estadístiques</h2>
                <p>En aquest espai pots filtrar la informació que apareix en el mapa. Fes click damunt de cadascun dels botons per anar veient els resultats obtinguts al aplicar cada filtre.</p>
                <div id="filtres">
                    <div class="col-sm">
                        <h3 style="text-align: center"><img style="height: 26px" src="https://img.icons8.com/ios/80/000000/empty-filter.png"/> Filtres</h3>
                    </div>
                    <div class="col-sm">
                        <p class="same-line-block-elem1"><b>Provincia</b><div class="same-line-block-elem2" id="provincies"></div></p>
                    </div>
                    <div class="col-sm">
                        <p class="same-line-block-elem1"><b>Ciutat</b><div style="margin-left: 25px" class="same-line-block-elem2" id="ubicacio"></div></p>
                    </div>
                    <div class="col-sm">
                        <p class="same-line-block-elem1"><b>Tipus</b><div style="margin-left: 29px" class="same-line-block-elem2" id="tipus"></div></p>
                    </div>
                    <div class="col-sm">
                        <p class="same-line-block-elem1"><input class="same-line-block-elem2" type="checkbox" onclick="canviEstat()" name="actiu" id="esActiu"> <b>Actiu</b></p>
                    </div>
                </div>
                <div id="botonera" class="btn-group" role="group" aria-label="Basic example">
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Resultat de la consulta actual." onclick="switchStatisticsData(this.id)" id="bttnconsultaActual"  value="Resultat de la consulta actual">Consulta Actual</button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Resultat d'aplicar un poble diferent al donat, actiu negat i no mateixa categoria." onclick="switchStatisticsData(this.id)" id="bttntotcontrari"  value="Resultat d'aplicar un poble diferent al donat, actiu negat i no mateixa categoria.">Resultat contrari</button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Totes les dades." onclick="switchStatisticsData(this.id)"  id="bttntotesdades"   value="Totes les dades.">Consultar tota la informació</button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Resultats obtinguts deprès d'haver negat si és actiu i mantenint la mateixa categoria." onclick="switchStatisticsData(this.id)" id="bttnactiunegatMateixaCategoria"  value="Resultats obtinguts deprès d'haver negat si és actiu i mantenint la mateixa categoria">Locals mateixa categoria</button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Resultat obtingut de aplicar el mateix poble amb l'actiu que s'ha donat i una categoria diferent a la donada.." onclick="switchStatisticsData(this.id)" id="bttnlocalsdiferents"  value="Resultat obtingut de aplicar el mateix poble amb l'actiu que s'ha donat i una categoria diferent a la donada.">Locals diferent categoria </button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Tots els locals que es troben en la mateixa ciutat (tant actius com no actius)." onclick="switchStatisticsData(this.id)" id="bttnmateixaCiutat"  value="Tots els locals que es troben en la mateixa ciutat (tant actius com no actius)">Locals mateixa ciutat</button>
                    <button type="button" class="btn btn-outline-secondary" data-placement="top" title="Resultat de aplicar altres pobles i actiu que s'ha donat i la mateixa categoria donada." onclick="switchStatisticsData(this.id)" id="bttnlocalsaltrespobles"  value="Resultat de aplicar altres pobles i actiu que s'ha donat i la mateixa categoria donada.">Locals altres pobles i categoria actual</button>
                </div>
            </div>
        </div>
    </div>
    <br>
    <div id="containerInformatiu" class="container">
        <div class="card card-body">
            <p>Apreta els botons de la botonera per anar veient els resultats.</p>
        </div>
    </div>
    <div id="containerInformatiu-NoCiutats" class="container" hidden>
        <div class="card card-body">
            <p>Tot deshabilitat perquè no hi ha localitzacions possibles.</p>
        </div>
    </div>
    <div class="container">
        <div id="resTOT1" hidden><!--RESULTATS CONSULTA ACTUAL-->

        </div>
        <div id="resTOT2" hidden> <!--RESULTATS LOCALS MATEIXA CIUTAT-->

        </div>
        <div id="resTOT3" hidden> <!--RESULTATS LOCALS MATEIXA CATEGORIA-->

        </div>
        <div id="resTOT4" hidden> <!--RESULTATS LOCALS DIFERENT CATEGORIA-->

        </div>
        <div id="resTOT5" hidden> <!--RESULTATS LOCALS ALTRES POBLES I CATEGORIA ACTUAL-->

        </div>
        <div id="resTOT6" hidden> <!--RESULTATS RESULTAT CONTRARI-->

        </div>
        <div id="resTOT7" hidden> <!--RESULTATS CONSULTAR TOTA LA INFORMACIÓ-->

        </div>
    </div>
    <input type="hidden" name="categoria" id="categoriaSeleccionada" value="Restauració">
    <input type="hidden" name="esActiu" id="estat" value="False">
    <input type="hidden" name="poblacio" id="pobleSeleccionat" value="">

    <input type="hidden" name="resTOT1-OrdenacioPerLocal" id="resTOT1-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT1-OrdenacioPerCategoria" id="resTOT1-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT1-OrdenacioPerEstatConservacio" id="resTOT1-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT1-OrdenacioPerAnyConstruccio" id="resTOT1-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT1-OrdenacioPerLocalitat" id="resTOT1-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT2-OrdenacioPerLocal" id="resTOT2-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT2-OrdenacioPerCategoria" id="resTOT2-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT2-OrdenacioPerEstatConservacio" id="resTOT2-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT2-OrdenacioPerAnyConstruccio" id="resTOT2-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT2-OrdenacioPerLocalitat" id="resTOT2-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT3-OrdenacioPerLocal" id="resTOT3-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT3-OrdenacioPerCategoria" id="resTOT3-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT3-OrdenacioPerEstatConservacio" id="resTOT3-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT3-OrdenacioPerAnyConstruccio" id="resTOT3-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT3-OrdenacioPerLocalitat" id="resTOT3-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT4-OrdenacioPerLocal" id="resTOT4-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT4-OrdenacioPerCategoria" id="resTOT4-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT4-OrdenacioPerEstatConservacio" id="resTOT4-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT4-OrdenacioPerAnyConstruccio" id="resTOT4-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT4-OrdenacioPerLocalitat" id="resTOT4-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT5-OrdenacioPerLocal" id="resTOT5-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT5-OrdenacioPerCategoria" id="resTOT5-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT5-OrdenacioPerEstatConservacio" id="resTOT5-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT5-OrdenacioPerAnyConstruccio" id="resTOT5-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT5-OrdenacioPerLocalitat" id="resTOT5-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT6-OrdenacioPerLocal" id="resTOT6-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT6-OrdenacioPerCategoria" id="resTOT6-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT6-OrdenacioPerEstatConservacio" id="resTOT6-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT6-OrdenacioPerAnyConstruccio" id="resTOT6-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT6-OrdenacioPerLocalitat" id="resTOT6-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT7-OrdenacioPerLocal" id="resTOT7-OrdenacioPerLocal" value="ordena">
    <input type="hidden" name="resTOT7-OrdenacioPerCategoria" id="resTOT7-OrdenacioPerCategoria" value="ordena">
    <input type="hidden" name="resTOT7-OrdenacioPerEstatConservacio" id="resTOT7-OrdenacioPerEstatConservacio" value="ordena">
    <input type="hidden" name="resTOT7-OrdenacioPerAnyConstruccio" id="resTOT7-OrdenacioPerAnyConstruccio" value="ordena">
    <input type="hidden" name="resTOT7-OrdenacioPerLocalitat" id="resTOT7-OrdenacioPerLocalitat" value="ordena">

    <input type="hidden" name="resTOT1-SentitOrdreNL" id="resTOT1-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT2-SentitOrdreNL" id="resTOT2-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT3-SentitOrdreNL" id="resTOT3-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT4-SentitOrdreNL" id="resTOT4-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT5-SentitOrdreNL" id="resTOT5-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT6-SentitOrdreNL" id="resTOT6-SentitOrdreNL" value="descendent">
    <input type="hidden" name="resTOT7-SentitOrdreNL" id="resTOT7-SentitOrdreNL" value="descendent">

    <input type="hidden" name="resTOT1-SentitOrdreC" id="resTOT1-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT2-SentitOrdreC" id="resTOT2-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT3-SentitOrdreC" id="resTOT3-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT4-SentitOrdreC" id="resTOT4-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT5-SentitOrdreC" id="resTOT5-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT6-SentitOrdreC" id="resTOT6-SentitOrdreC" value="descendent">
    <input type="hidden" name="resTOT7-SentitOrdreC" id="resTOT7-SentitOrdreC" value="descendent">

    <input type="hidden" name="resTOT1-SentitOrdreEC" id="resTOT1-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT2-SentitOrdreEC" id="resTOT2-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT3-SentitOrdreEC" id="resTOT3-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT4-SentitOrdreEC" id="resTOT4-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT5-SentitOrdreEC" id="resTOT5-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT6-SentitOrdreEC" id="resTOT6-SentitOrdreEC" value="descendent">
    <input type="hidden" name="resTOT7-SentitOrdreEC" id="resTOT7-SentitOrdreEC" value="descendent">

    <input type="hidden" name="resTOT1-SentitOrdreAC" id="resTOT1-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT2-SentitOrdreAC" id="resTOT2-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT3-SentitOrdreAC" id="resTOT3-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT4-SentitOrdreAC" id="resTOT4-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT5-SentitOrdreAC" id="resTOT5-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT6-SentitOrdreAC" id="resTOT6-SentitOrdreAC" value="descendent">
    <input type="hidden" name="resTOT7-SentitOrdreAC" id="resTOT7-SentitOrdreAC" value="descendent">

    <input type="hidden" name="resTOT1-SentitOrdreL" id="resTOT1-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT2-SentitOrdreL" id="resTOT2-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT3-SentitOrdreL" id="resTOT3-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT4-SentitOrdreL" id="resTOT4-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT5-SentitOrdreL" id="resTOT5-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT6-SentitOrdreL" id="resTOT6-SentitOrdreL" value="descendent">
    <input type="hidden" name="resTOT7-SentitOrdreL" id="resTOT7-SentitOrdreL" value="descendent">

    <br><br>

<script>

function fade(element) {
    var op = 1;  // initial opacity
    var timer = setInterval(function () {
        if (op <= 0.1){
            clearInterval(timer);
            element.style.display = 'none';
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op -= op * 0.1;
    }, 50);
}
function unfade(element) {
    var op = 0.1;  // initial opacity
    element.style.display = 'block';
    var timer = setInterval(function () {
        if (op >= 1){
            clearInterval(timer);
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op += op * 0.1;
    }, 10);
}

function showInstructions(){
    if (document.getElementById("instruccions").hidden === false){
        document.getElementById("instruccions").hidden = true;
        fade(document.getElementById("instruccions"));
    }else{
        document.getElementById("instruccions").hidden = false;
        unfade(document.getElementById("instruccions"));
    }
}
function inicialitzacioEstadistiques(){
    var divpobles = document.getElementById("ubicacio");
    var divtipus =document.getElementById("tipus");
    var poblesTGN = JSON.parse(`{{poblesTGN | safe}}`);
    var totescategories = JSON.parse(`{{totesCategories | safe}}`);
    var divProvincies = document.getElementById("provincies");
    var provincies =JSON.parse(`{{ provincies | safe }}`);
    document.getElementById("pobleSeleccionat").value=`{{primeraLocalitatLlista | safe}}`;
    var llProvincies = Object.values(provincies);
    var llPoblesTGN = Object.values(poblesTGN);
    var categoriesToDo = [];
    for(categoria of totescategories)
    {
        categoriesToDo.push({
            "categoria" : categoria.fields.categoria
        });
    }
    //console.log(llPoblesTGN);
    var sPoble = document.createElement("SELECT");
    sPoble.setAttribute("id", "poblacioSeleccio");
    sPoble.setAttribute("class", "form-control");
    sPoble.setAttribute("onchange", "guardarPoblacio()");
    divpobles.appendChild(sPoble);
    for(var j=0; j<llPoblesTGN.length; j++){
        let option = document.createElement("option");
        option.setAttribute("value", llPoblesTGN[j]);
        let t = document.createTextNode(llPoblesTGN[j]);
        option.appendChild(t);
        document.getElementById("poblacioSeleccio").appendChild(option);
    }

    var sCategoria = document.createElement("SELECT");
    sCategoria.setAttribute("id", "tipusSeleccio");
    sCategoria.setAttribute("class", "form-control");
    sCategoria.setAttribute("onchange", "guardarTipus()");
    divtipus.appendChild(sCategoria);
    for(var i=0; i<categoriesToDo.length; i++){
        let option = document.createElement("option");
        option.setAttribute("value", categoriesToDo[i]['categoria']);
        let t = document.createTextNode(categoriesToDo[i]['categoria']);
        option.appendChild(t);
        document.getElementById("tipusSeleccio").appendChild(option);
    }
    var sProvincia = document.createElement("SELECT");
    sProvincia.setAttribute("id", "provinciaSeleccio");
    sProvincia.setAttribute("class", "form-control");
    sProvincia.setAttribute("onchange", "poblacionsPerProvincia()");
    divProvincies.appendChild(sProvincia);
    for(var k=0; k<llProvincies.length; k++){
        let option = document.createElement("option");
        option.setAttribute("value", llProvincies[k]);
        let t = document.createTextNode(llProvincies[k]);
        option.appendChild(t);
        document.getElementById("provinciaSeleccio").appendChild(option);
    }
    /*crearInformacio("resTOT1");
    crearInformacio("resTOT2");
    crearInformacio("resTOT3");
    crearInformacio("resTOT4");
    crearInformacio("resTOT5");
    crearInformacio("resTOT6");
    crearInformacio("resTOT7");*/
    $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques_inicials/',
            data:{
                'categoria':document.getElementById("categoriaSeleccionada").value,
                'poblacio': document.getElementById("pobleSeleccionat").value
            },
            dataType:'json',
            success:
                function (data){
                    tractamentDadesEstadistiques(data, 'inicials');
                }
    });
}

function tractamentDadesEstadistiques(data, quines_dades){
    var totescategories = JSON.parse(`{{totesCategories | safe}}`);
    var totesLocalitzacions = JSON.parse(`{{totesLocalitzacions |safe}}`);
    var categoriesToDo = [];
    var localitzacionsToDo=[];
    for(localitzacio of totesLocalitzacions){
        localitzacionsToDo.push({
            'pk':localitzacio.pk,
            'ciutat':localitzacio.fields.ciutat
        });
    }

    for(categoria of totescategories)
    {
        categoriesToDo.push({
            'pk':categoria.pk,
            "categoria" : categoria.fields.categoria
        });
    }
    if(quines_dades ==='inicials' || quines_dades === 'estadistiques'){
        var data1 = Object.values(data);
        for (var i=0; i<7; i++){
            let infoReal = Object.values(data1[i]);
            if(infoReal[1]!=='0'){
                let info = JSON.parse(infoReal[0]);
                let infoToDo = [];
                for (informacio of info){
                    //console.log(informacio);
                    infoToDo.push({
                        'fk_puntInteres': informacio.fields.localitzacio,
                        'nomLocal' : informacio.fields.nomLocal,
                        'anyConstruccio' : informacio.fields.anyConstruccio,
                        'descripcio' : informacio.fields.descripcio,
                        'fk_categoria' : informacio.fields.categoria,
                        'estat_conservacio':informacio.fields.estat_conservacio
                    });
                }
                let infoPI = JSON.parse(infoReal[2]);
                let infoPuntInteres = [];
                for(pInteres of infoPI){
                    infoPuntInteres.push({
                        'pk':pInteres.pk,
                        'latitud' : pInteres.fields.latitud,
                        'longitud' : pInteres.fields.longitud,
                        'latitudS':pInteres.fields.latitud.toString(),
                        'longitudS':pInteres.fields.longitud.toString(),
                        'fk_localitzacio':pInteres.fields.localitat
                    });
                }
                switchInfoGraellaAMBdades(infoToDo.length, "resTOT"+(i+1).toString());
                document.getElementById("textNumElems"+(i+1).toString()).innerHTML="Nombre de resultats: "+infoToDo.length.toString();
                for(var j = 0; j<infoToDo.length; j++){
                    var link=crearLink(infoToDo[j],infoPuntInteres); //objecte link
                    //fila, columna, id_div_sortida, infoToPut
                    var categoria=cercarCategoria(infoToDo[j]['fk_categoria'], categoriesToDo);
                    var punt_fk_localitzacio=cercarPuntInteres(infoToDo[j]['fk_puntInteres'], infoPuntInteres);
                    var localitat = cercarLocalitat(punt_fk_localitzacio, localitzacionsToDo);
                    var sEstrelletes=estrelles(infoToDo[j]['estat_conservacio'], infoToDo[j]['nomLocal']);
                    afegirInfoCasellaEspecifica((j+1), 1, "resTOT"+(i+1).toString() ,link);
                    afegirInfoCasellaEspecifica((j+1), 2, "resTOT"+(i+1).toString() ,categoria);
                    afegirInfoCasellaEspecifica((j+1), 3, "resTOT"+(i+1).toString() ,sEstrelletes);
                    afegirInfoCasellaEspecifica((j+1), 4, "resTOT"+(i+1).toString() ,infoToDo[j]['anyConstruccio'].toString());
                    afegirInfoCasellaEspecifica((j+1), 5, "resTOT"+(i+1).toString(), localitat);
                    afegirInfoCasellaEspecifica((j+1), 6, "resTOT"+(i+1).toString() ,infoToDo[j]['descripcio']);
                }
            }else{
                var llistatBotons = document.getElementById("botonera").children;
                onlyInfo(llistatBotons[i].value,"resTOT"+(i+1).toString());
            }
        }
    }
}
function estrelles(numEstrelles, nomLocal){
    switch(numEstrelles){
        case 0:
            return '<i class="fa fa-star unchecked" id="1<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="2<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="3<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="4<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="5<>'+nomLocal+'"></i>';;
            break;
        case 1:
            return '<i class="fa fa-star checked" id="1<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="2<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="3<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="4<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="5<>'+nomLocal+'"></i>';;
            break;
        case 2:
            return '<i class="fa fa-star checked" id="1<>'+nomLocal+'"></i><i class="fa fa-star checked" id="2<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="3<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="4<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="5<>'+nomLocal+'"></i>';;
            break;
        case 3:
            return '<i class="fa fa-star checked" id="1<>'+nomLocal+'"></i><i class="fa fa-star checked" id="2<>'+nomLocal+'"></i><i class="fa fa-star checked" id="3<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="4<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="5<>'+nomLocal+'"></i>';;
            break;
        case 4:
            return '<i class="fa fa-star checked" id="1<>'+nomLocal+'"></i><i class="fa fa-star checked" id="2<>'+nomLocal+'"></i><i class="fa fa-star checked" id="3<>'+nomLocal+'"></i><i class="fa fa-star checked" id="4<>'+nomLocal+'"></i><i class="fa fa-star unchecked" id="5<>'+nomLocal+'"></i>';;
            break;
        case 5:
            return '<i class="fa fa-star checked" id="1<>'+nomLocal+'"></i><i class="fa fa-star checked" id="2<>'+nomLocal+'"></i><i class="fa fa-star checked" id="3<>'+nomLocal+'"></i><i class="fa fa-star checked" id="4<>'+nomLocal+'"></i><i class="fa fa-star checked" id="5<>'+nomLocal+'"></i>';;
            break;
    }
}
function cercarLocalitat(fk_localitat, totesLocalitats){
    for(var i=0; i<totesLocalitats.length; i++){
        if(fk_localitat === totesLocalitats[i]['pk']){
            return totesLocalitats[i]['ciutat'];
        }
    }
}
function cercarPuntInteres(fk_puntInteres, totsPuntsInteres){
    for(var i=0; i<totsPuntsInteres.length; i++){
        if(fk_puntInteres === totsPuntsInteres[i]['pk']){
            return totsPuntsInteres[i]['fk_localitzacio']
        }
    }
}
function cercarCategoria(fk_categoria, totesCategories) {
    for(var i=0; i<totesCategories.length; i++){
        if(fk_categoria === totesCategories[i]['pk']){
            return totesCategories[i]['categoria'];
        }
    }
}

function switchInfoGraellaAMBdades(files, id_div_sortida){
    switch (id_div_sortida) {
        case "resTOT1":
            crearGraella(files, 'Resultat de la consulta actual',"resTOT1");
            break;
        case "resTOT2":
            crearGraella(files, 'Resultat de negar totes les dades d\'entrada',"resTOT2");
            break;
        case "resTOT3":
            crearGraella(files, 'Totes les dades del sistema GIS',"resTOT3");
            break;
        case "resTOT4":
            crearGraella(files, "Tots els locals que es troben en la mateixa ciutat (tant actius com no actius)","resTOT4");
            break;
        case "resTOT5":
            crearGraella(files, "Resultats obtinguts actiu negat, mateixa categoria i poble","resTOT5");
            break;
        case "resTOT6":
            crearGraella(files, "Resultat obtingut mateix poble i actiu, però diferent categoria","resTOT6");
            break;
        case "resTOT7":
            crearGraella(files, "Resultat de mantenir mateix actiu i categoria, però canviant la localitat","resTOT7");
            break;

    }
}
function crearLink(local, puntsInteres){
    for(var n=0; n<puntsInteres.length; n++){
        if(local['fk_puntInteres'] == puntsInteres[n]['pk']){
            let url = "localhost:8000/v1/geoInfoSystem/info_especifica/"+local['nomLocal']+"/"+puntsInteres[n]['latitudS']+"/"+puntsInteres[n]['longitudS']+"/";
            url = encodeURI(url);
            return '<a href="'+"localhost:8000/v1/geoInfoSystem/info_especifica/"+local['nomLocal']+"/"+puntsInteres[n]['latitudS']+"/"+puntsInteres[n]['longitudS']+"/"+'" target="_blank" rel="noopener noreferrer">'+local['nomLocal']+'</a>';
        }
    }
}



function poblacionsPerProvincia(){
    var elem = document.getElementById("provinciaSeleccio");
    elem.childNodes.forEach(node => {
      if(node.selected){
            var defecte=node.value;
            $.ajax({
                type: 'GET',
                url : '/v1/geoInfoSystem/poblacions_per_provincia_estadistiques/',
                data:{
                    'provincia' : defecte
                },
                dataType:'json',
                success:
                    function (data){
                        var data1 = Object.values(data);
                        var pobles = Object.values(data1[0]);
                        var divpoble = document.getElementById("ubicacio");
                        divpoble.innerHTML="";
                        if (pobles.length!== 0){
                            //console.log(pobles);
                            var sPoble = document.createElement("SELECT");
                            sPoble.setAttribute("id", "poblacioSeleccio");
                            sPoble.setAttribute("class", "form-control");
                            sPoble.setAttribute("onchange", "guardarPoblacio()");
                            divpoble.appendChild(sPoble);
                            for(var j=0; j<pobles.length; j++){
                            let option = document.createElement("option");
                            option.setAttribute("value", pobles[j]+", "+defecte);
                            let t = document.createTextNode(pobles[j]+", "+defecte);
                            option.appendChild(t);
                            document.getElementById("poblacioSeleccio").appendChild(option);
                            }
                            setvalor(pobles[0]+", "+defecte);

                            if (document.getElementById("tipusSeleccio").disabled === true)
                                document.getElementById("tipusSeleccio").disabled = false;
                            if (document.getElementById("esActiu").disabled === true)
                                document.getElementById("esActiu").disabled=false;
                            if(document.getElementById("bttnconsultaActual").disabled === true)
                                document.getElementById("bttnconsultaActual").disabled=false;
                            if(document.getElementById("bttntotcontrari").disabled=== true)
                                document.getElementById("bttntotcontrari").disabled=false;
                            if(document.getElementById("bttntotesdades").disabled=== true)
                                document.getElementById("bttntotesdades").disabled=false;
                            if(document.getElementById("bttnmateixaCiutat").disabled=== true)
                                document.getElementById("bttnmateixaCiutat").disabled=false;
                            if(document.getElementById("bttnactiunegatMateixaCategoria").disabled=== true)
                                document.getElementById("bttnactiunegatMateixaCategoria").disabled=false;
                            if(document.getElementById("bttnlocalsdiferents").disabled=== true)
                                document.getElementById("bttnlocalsdiferents").disabled=false;
                            if(document.getElementById("bttnlocalsaltrespobles").disabled=== true)
                                document.getElementById("bttnlocalsaltrespobles").disabled=false;
                            document.getElementById("containerInformatiu-NoCiutats").hidden=true;
                            document.getElementById("containerInformatiu").hidden=false;
                        }else{
                            var b = document.createElement("B");
                            var t = document.createTextNode("No hi ha localitzacions amb punts d'interès en aquesta província.");
                            b.appendChild(t);
                            b.setAttribute("style", "color:red");
                            divpoble.appendChild(b);
                            document.getElementById("tipusSeleccio").disabled= true;
                            document.getElementById("esActiu").disabled = true;
                            document.getElementById("bttnconsultaActual").disabled = true;
                            document.getElementById("bttntotcontrari").disabled = true;
                            document.getElementById("bttntotesdades").disabled = true;
                            document.getElementById("bttnmateixaCiutat").disabled = true;
                            document.getElementById("bttnactiunegatMateixaCategoria").disabled = true;
                            document.getElementById("bttnlocalsdiferents").disabled = true;
                            document.getElementById("bttnlocalsaltrespobles").disabled = true;
                            totsResHiddenIMostrarInformacio();
                        }

                    }
            });
      }
    });
}

function totsResHiddenIMostrarInformacio(){
    for(var i=1; i<=7; i++){
        document.getElementById("resTOT"+i).hidden=true;
    }
    document.getElementById("containerInformatiu-NoCiutats").hidden=false;
    document.getElementById("containerInformatiu").hidden=true;
}

function setvalor(myValue) {
     $('#pobleSeleccionat').val(myValue)
                 .trigger('change');
}
$('#pobleSeleccionat').change( function() {
    console.log('vaaa jeje');
    var actiu = document.getElementById("estat");
    var categoria =document.getElementById("categoriaSeleccionada");
    $.ajax({
                type: 'GET',
                url : '/v1/geoInfoSystem/estadistiques/',
                data:{
                    'poblacio' : $('#pobleSeleccionat').val(),
                    'actiu' : actiu.value,
                    'categoria' : categoria.value
                },
                dataType:'json',
                success:
                    function (data){
                        tractamentDadesEstadistiques(data, 'estadistiques');
                    }
            });



});

function switchStatisticsData(idbtn) {
    switch (idbtn) {
        case "bttnconsultaActual":
            //console.log('consulta actuaaal');
            document.getElementById("resTOT1").hidden = document.getElementById("resTOT1").hidden == true ? false : true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT1").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttnmateixaCiutat":
            //console.log('consulta de la mateixa ciutat');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = document.getElementById("resTOT2").hidden == true ? false : true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT2").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttnactiunegatMateixaCategoria":
            //console.log('consulta actiu negat i la mateixa categoria');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = document.getElementById("resTOT3").hidden == true ? false : true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT3").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttnlocalsdiferents":
            //console.log('consulta actiu que em ve categoria diferent mateixa ciutat');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = document.getElementById("resTOT4").hidden == true ? false : true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT4").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttnlocalsaltrespobles":
            //console.log('consulta altres pobles amb la mateixa categoria');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = document.getElementById("resTOT5").hidden == true ? false : true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT5").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttntotcontrari":
            //console.log('resultat contrari');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = document.getElementById("resTOT6").hidden == true ? false : true;
            document.getElementById("resTOT7").hidden = true;
            if(document.getElementById("resTOT6").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
        case "bttntotesdades":
            //console.log('dades db');
            document.getElementById("resTOT1").hidden = true;
            document.getElementById("resTOT2").hidden = true;
            document.getElementById("resTOT3").hidden = true;
            document.getElementById("resTOT4").hidden = true;
            document.getElementById("resTOT5").hidden = true;
            document.getElementById("resTOT6").hidden = true;
            document.getElementById("resTOT7").hidden = document.getElementById("resTOT7").hidden == true ? false : true;
            if(document.getElementById("resTOT7").hidden == false){
                document.getElementById("containerInformatiu").hidden=true;
            }else{
                document.getElementById("containerInformatiu").hidden = false;
            }
            break;
    }
}

function crearInformacio(id_div){
    switch (id_div) {
        case "resTOT1":
            crearGraella(-1, 'Resultat de la consulta actual', id_div);
            break;
        case "resTOT2":
            crearGraella(-1, 'Resultat de negar totes les dades d\'entrada', id_div);
            break;
        case "resTOT3":
            crearGraella(-1, 'Totes les dades del sistema GIS', id_div);
            break;
        case "resTOT4":
            crearGraella(-1, "Tots els locals que es troben en la mateixa ciutat (tant actius com no actius)", id_div);
            break;
        case "resTOT5":
            crearGraella(-1, "Resultats obtinguts actiu negat, mateixa categoria i poble", id_div);
            break;
        case "resTOT6":
            crearGraella(-1, "Resultat obtingut mateix poble i actiu, però diferent categoria", id_div);
            break;
        case "resTOT7":
            crearGraella(-1, "Resultat de mantenir mateix actiu i categoria, però canviant la localitat", id_div);
            break;
    }
}


function netejarEstadistiques(){
    for(var i=1; i<=7; i++){
        crearInformacio("resTOT"+i);
    }
}

function guardarPoblacio(){
    var inputOcult = document.getElementById("pobleSeleccionat");
    var elem = document.getElementById("poblacioSeleccio");

    elem.childNodes.forEach(node => {
        if(node.selected){
            //console.log(node.value);
            setvalor(node.value);
        }
    });
}
function canviEstat(){
    var inputhidden = document.getElementById("estat");
    if (inputhidden.value == 'False'){
        inputhidden.value = 'True';
    }else inputhidden.value = 'False';
    $.ajax({
                type: 'GET',
                url : '/v1/geoInfoSystem/estadistiques/',
                data:{
                    'poblacio' : document.getElementById('pobleSeleccionat').value,
                    'actiu' : inputhidden.value,
                    'categoria' : document.getElementById("categoriaSeleccionada").value
                },
                dataType:'json',
                success:
                    function (data){
                        tractamentDadesEstadistiques(data, 'estadistiques');
                    }
            });
}
function guardarTipus(){
        var inputhidden = document.getElementById("categoriaSeleccionada");
        var elem = document.getElementById("tipusSeleccio");
        elem.childNodes.forEach(node => {
            if(node.selected){
                //console.log(node.value);
                inputhidden.value = node.value;
                $.ajax({
                    type: 'GET',
                    url : '/v1/geoInfoSystem/estadistiques/',
                    data:{
                        'poblacio' : document.getElementById('pobleSeleccionat').value,
                        'actiu' : document.getElementById('estat').value,
                        'categoria' : inputhidden.value
                    },
                    dataType:'json',
                    success:
                        function (data) {
                            tractamentDadesEstadistiques(data, 'estadistiques');
                        }
                });
            }
        });
    }

function onlyInfo(descipcioResultat, id_div_sortida){
    var div,b,t, div1, b1, t1, br ;
     //generar requadre dient que no hi ha informació
    document.getElementById(id_div_sortida).innerHTML='';
    div1=document.createElement("DIV");
    b1=document.createElement("B");
    t1=document.createTextNode("No hi ha resultats en aquesta pestanya.");
    b1.appendChild(t1);
    b1.setAttribute("id", "textNumElems"+getNumResultat(id_div_sortida).toString());
    div1.appendChild(b1);
    br = document.createElement("br");
    div1.appendChild(br);
    document.getElementById(id_div_sortida).appendChild(div1);
}

function crearGraella(files, descipcioResultat, id_div_sortida){
    document.getElementById(id_div_sortida).innerHTML='';
    onlyInfo(descipcioResultat, id_div_sortida);
    if(files === -1 || files === 0){
        //nore
    }else{
        var table=document.createElement("TABLE");
        var primertr = document.createElement("TR");
        for(var k=0; k<6; k++){
            switch (k+1){
                case 1:
                    let th1 = document.createElement("TH");
                    let bttn_ordenar1 = document.createElement("BUTTON");
                    let t1 = document.createTextNode("Nom local");
                    let divRow1=document.createElement("DIV");
                    divRow1.setAttribute("class", "col");
                    divRow1.setAttribute("style", "margin:0px auto;");
                    if(document.getElementById(id_div_sortida+"-SentitOrdreNL").value==='descendent'){
                        bttn_ordenar1.innerHTML='<img style="height: 15px" src="https://image.flaticon.com/icons/svg/690/690342.svg">';
                    }else{
                        bttn_ordenar1.innerHTML='<img style="height: 15px" src="https://img.icons8.com/material-outlined/24/000000/alphabetical-sorting-2.png"/>';
                    }
                    bttn_ordenar1.setAttribute("onclick", "ordenarPerNomLocals(this.id)");
                    bttn_ordenar1.setAttribute("class", "btn btn-outline-info");
                    bttn_ordenar1.setAttribute("id", "bttnORDNL "+id_div_sortida);
                    divRow1.appendChild(t1);
                    let divRowButton1=document.createElement("DIV");
                    divRowButton1.setAttribute("style", "margin-top:10px");
                    divRowButton1.appendChild(bttn_ordenar1);
                    divRow1.appendChild(divRowButton1);
                    th1.appendChild(divRow1);
                    document.getElementById(id_div_sortida).appendChild(th1);
                    break;
                case 2:
                    let th2 = document.createElement("TH");
                    let t2 = document.createTextNode("Categoria");
                    let bttn_ordenar2 = document.createElement("BUTTON");
                    let divRow2=document.createElement("DIV");
                    divRow2.setAttribute("class", "col");
                    divRow2.setAttribute("style", "margin:0px auto;");
                    if(document.getElementById(id_div_sortida+"-SentitOrdreC").value ==='descendent'){
                        bttn_ordenar2.innerHTML='<img style="height: 15px" src="https://image.flaticon.com/icons/svg/690/690342.svg">';
                    }else{
                        bttn_ordenar2.innerHTML='<img style="height: 15px" src="https://img.icons8.com/material-outlined/24/000000/alphabetical-sorting-2.png"/>';
                    }
                    bttn_ordenar2.setAttribute("onclick", "ordenarPerCategories(this.id)");
                    bttn_ordenar2.setAttribute("class", "btn btn-outline-info");
                    bttn_ordenar2.setAttribute("id", "bttnORDC "+id_div_sortida);
                    divRow2.appendChild(t2);
                    let divRowButton2=document.createElement("DIV");
                    divRowButton2.setAttribute("style", "margin-top:30px; text-align:center;");
                    divRowButton2.appendChild(bttn_ordenar2);
                    divRow2.appendChild(divRowButton2);
                    th2.appendChild(divRow2);
                    document.getElementById(id_div_sortida).appendChild(th2);
                    break;
                case 3:
                    let th3 = document.createElement("TH");
                    let t3 = document.createTextNode("Estat de conservació");
                    let bttn_ordenar3 = document.createElement("BUTTON");
                    let divRow3=document.createElement("DIV");
                    divRow3.setAttribute("class", "col");
                    divRow3.setAttribute("style", "margin:0px auto;");
                    if(document.getElementById(id_div_sortida+"-SentitOrdreEC").value ==='descendent')
                        bttn_ordenar3.innerHTML='<img style="height: 15px" src="https://image.flaticon.com/icons/svg/1828/1828135.svg">';
                    else{
                        bttn_ordenar3.innerHTML=`<img style="height: 15px;" src="{% static '9To1ico.png' %}"/>`;
                    }
                    bttn_ordenar3.setAttribute("onclick", "ordenarPerEstatConservacio(this.id)");
                    bttn_ordenar3.setAttribute("class", "btn btn-outline-info");
                    bttn_ordenar3.setAttribute("id", "bttnORDEC "+id_div_sortida);
                    divRow3.appendChild(t3);
                    let divRowButton3=document.createElement("DIV");
                    divRowButton3.setAttribute("style", "margin-top: 7px; text-align:center;");
                    divRowButton3.appendChild(bttn_ordenar3);
                    divRow3.appendChild(divRowButton3);
                    th3.appendChild(divRow3);
                    document.getElementById(id_div_sortida).appendChild(th3);
                    break;
                case 4:
                    let th4 = document.createElement("TH");
                    let t4 = document.createTextNode("Any de construcció");
                    let bttn_ordenar4 = document.createElement("BUTTON");
                    let divRow4=document.createElement("DIV");
                    divRow4.setAttribute("class", "col");
                    divRow4.setAttribute("style", "margin:0px auto;");
                    if(document.getElementById(id_div_sortida+"-SentitOrdreAC").value === 'descendent'){
                        bttn_ordenar4.innerHTML='<img style="height: 15px" src="https://image.flaticon.com/icons/svg/1828/1828135.svg">';
                    }else{
                        bttn_ordenar4.innerHTML=`<img style="height: 15px;" src="{% static '9To1ico.png' %}"/>`;
                    }
                    bttn_ordenar4.setAttribute("onclick", "ordenarPerAnyConstrucccio(this.id)");
                    bttn_ordenar4.setAttribute("class", "btn btn-outline-info");
                    bttn_ordenar4.setAttribute("id", "bttnORDAC "+id_div_sortida);
                    divRow4.appendChild(t4);
                    let divRowButton4 = document.createElement("DIV");
                    divRowButton4.setAttribute("style", "margin-top:7px; text-align:center;");
                    divRowButton4.appendChild(bttn_ordenar4);
                    divRow4.appendChild(divRowButton4);
                    th4.appendChild(divRow4);
                    document.getElementById(id_div_sortida).appendChild(th4);
                    break;
                case 5:
                    let th5 = document.createElement("TH");
                    let t5 = document.createTextNode("Localitat");
                    let bttn_ordenar5=document.createElement("BUTTON");
                    let divRow5=document.createElement("DIV");
                    divRow5.setAttribute("class", "col");
                    divRow5.setAttribute("style", "margin:0px auto;");
                    if(document.getElementById(id_div_sortida+"-SentitOrdreL").value ==='descendent'){
                        bttn_ordenar5.innerHTML='<img style="height: 15px" src="https://image.flaticon.com/icons/svg/690/690342.svg">';
                    }else{
                        bttn_ordenar5.innerHTML='<img style="height: 15px" src="https://img.icons8.com/material-outlined/24/000000/alphabetical-sorting-2.png"/>';
                    }
                    bttn_ordenar5.setAttribute("onclick", "ordenarPerLocalitat(this.id)");
                    bttn_ordenar5.setAttribute("class", "btn btn-outline-info");
                    bttn_ordenar5.setAttribute("id", "bttnORDL "+id_div_sortida);
                    divRow5.appendChild(t5);
                    let divRowButton5=document.createElement("DIV");
                    divRowButton5.setAttribute("style", "margin-top:30px; text-align:center;");
                    divRowButton5.appendChild(bttn_ordenar5);
                    divRow5.appendChild(divRowButton5);
                    th5.appendChild(divRow5);
                    document.getElementById(id_div_sortida).appendChild(th5);
                    break;
                case 6:
                    let th6 = document.createElement("TH");
                    let t6 = document.createTextNode("Descripció");
                    th6.appendChild(t6);
                    document.getElementById(id_div_sortida).appendChild(th6);
                    break;
            }
        }
        for (var i = 0; i<files; i++){
            let tr = document.createElement("TR");
            for(var j=0; j<6; j++){
                let td = document.createElement("TD");
                td.setAttribute("id", "infofil"+(i+1).toString()+"col"+(j+1).toString()+" "+id_div_sortida);
                tr.appendChild(td);
            }
            document.getElementById(id_div_sortida).appendChild(tr);
        }
    }
}

function getNumResultat(id_div_res){
    var regex = /[+-]?\d+(?:\.\d+)?/g;
    var str=id_div_res;
    var match;
    match = regex.exec(str);
    return match[0];
}


function afegirInfoCasellaEspecifica(fila, columna, id_div_sortida, infoToPut){
    document.getElementById("infofil"+fila.toString()+"col"+columna.toString()+" "+id_div_sortida).innerHTML=infoToPut;
}

function treureObjecteCasella(id_td){
    return document.getElementById(id_td);
}

function getAllTRs(llistatTags){
    var llistatObjectes=[];
    for(var i=0; i<llistatTags.length; i++){
        if(llistatTags[i].nodeName ==='TR'){
            llistatObjectes.push(llistatTags[i]);
        }
    }
    return llistatObjectes;
}
function getJSONData(element_TR){
    var objectes=element_TR.childNodes;
    var JSON_data={};
    var estatConservacio=0;
    var k=0;
    for(var i=0; i<objectes.length; i++){
        let objecte=treureObjecteCasella(objectes[i].id);
        let contingut=objecte.childNodes;
        for(var j=0; j<contingut.length;j++){
            switch(contingut[j].tagName){
                case "A":
                    JSON_data['nomLocal']=contingut[j].innerHTML;
                    JSON_data['url']=contingut[j].href;
                    break;
                case "I":
                    if(contingut[j].classList.value === 'fa fa-star checked'){
                        estatConservacio=estatConservacio+1;
                    }
                    break;
                default:
                    JSON_data['colsText'+(k+1).toString()]=contingut[j].textContent;
                    k=k+1;
                    break;
            }
        }
    }
    JSON_data["estatConservacio"]=estatConservacio;
    return JSON_data;
}
function afegirInfoCasellaEspecifica(fila, columna, id_div_sortida, infoToPut){
    document.getElementById("infofil"+fila.toString()+"col"+columna.toString()+" "+id_div_sortida).innerHTML=infoToPut;
}
function ordenarPerNomLocals(id_boto){
    var divSortida=id_boto.split(' ')[1];
    //console.log(divSortida);
    var llistatTags = document.getElementById(divSortida).childNodes;
    var trs=getAllTRs(llistatTags);
    //console.log(trs);
    var llistatfiles=[];
    for(var i=0; i<trs.length; i++){
        llistatfiles.push(JSON.stringify(getJSONData(trs[i])));
    }

    if(document.getElementById(divSortida+"-OrdenacioPerLocal").value==='ordena'){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/ordenacio/',
            data:{
                'tipusOrdenacio': 'nomLocal',
                'informacio' : JSON.stringify(llistatfiles),
                'sentit': document.getElementById(divSortida+"-SentitOrdreNL").value
            },
            dataType:'json',
            success:
                function (data){
                    var data1 = Object.values(data);
                    crearGraella(data1.length, '', divSortida);
                    document.getElementById("textNumElems"+getNumResultat(divSortida).toString()).innerHTML="Nombre de resultats: "+data1.length;
                    for(var i=0; i<data1.length; i++){
                        let info_array = Object.values(data1[i]);
                        for(var j=1; j<info_array.length; j++){
                            console.log(info_array[j]);
                            if(j === 1){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, '<a href="'+info_array[j]+'" target="_blank" rel="noopener noreferrer">'+info_array[0]+'</a>')
                            }else if (j===3){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, estrelles(info_array[j], info_array[0]));
                            }else{
                                afegirInfoCasellaEspecifica(i+1,j,divSortida, info_array[j]);
                            }
                        }
                    }
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerLocal").value='NoOrdena';
        if(document.getElementById(divSortida+"-SentitOrdreNL").value=== 'descendent'){
            document.getElementById(divSortida+"-SentitOrdreNL").value= 'ascendent';
        }else{
            document.getElementById(divSortida+"-SentitOrdreNL").value='descendent';
        }
    }else{
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques/',
            data:{
                'poblacio' : document.getElementById('pobleSeleccionat').value,
                'actiu' : document.getElementById('estat').value,
                'categoria' : document.getElementById("categoriaSeleccionada").value
            },
            dataType:'json',
            success:
                function (data) {
                    tractamentDadesEstadistiques(data, 'estadistiques');
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerLocal").value='ordena';
    }

}
function ordenarPerCategories(id_boto){
    var divSortida=id_boto.split(' ')[1];
    //console.log(divSortida);
    var llistatTags = document.getElementById(divSortida).childNodes;
    var trs=getAllTRs(llistatTags);
    //console.log(trs);
    var llistatfiles=[];
    for(var i=0; i<trs.length; i++){
        llistatfiles.push(JSON.stringify(getJSONData(trs[i])));
    }
    if(document.getElementById(divSortida+"-OrdenacioPerCategoria").value==='ordena'){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/ordenacio/',
            data:{
                'tipusOrdenacio': 'categoria',
                'informacio' : JSON.stringify(llistatfiles),
                'sentit' : document.getElementById(divSortida+"-SentitOrdreC").value
            },
            dataType:'json',
            success:
                function (data){
                    var data1 = Object.values(data);
                    crearGraella(data1.length, '', divSortida);
                    document.getElementById("textNumElems"+getNumResultat(divSortida).toString()).innerHTML="Nombre de resultats: "+data1.length;
                    for(var i=0; i<data1.length; i++){
                        let info_array = Object.values(data1[i]);
                        for(var j=1; j<info_array.length; j++){
                            console.log(info_array[j]);
                            if(j === 1){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, '<a href="'+info_array[j]+'" target="_blank" rel="noopener noreferrer">'+info_array[0]+'</a>')
                            }else if (j===3){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, estrelles(info_array[j], info_array[0]));
                            }else{
                                afegirInfoCasellaEspecifica(i+1,j,divSortida, info_array[j]);
                            }
                        }
                    }
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerCategoria").value='NoOrdena';
        if(document.getElementById(divSortida+"-SentitOrdreC").value ==='descendent'){
            document.getElementById(divSortida+"-SentitOrdreC").value = 'ascendent';
        }else{
            document.getElementById(divSortida+"-SentitOrdreC").value = 'descendent';
        }
    }else{
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques/',
            data:{
                'poblacio' : document.getElementById('pobleSeleccionat').value,
                'actiu' : document.getElementById('estat').value,
                'categoria' : document.getElementById("categoriaSeleccionada").value
            },
            dataType:'json',
            success:
                function (data) {
                    tractamentDadesEstadistiques(data, 'estadistiques');
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerCategoria").value='ordena';
    }
}
function ordenarPerEstatConservacio(id_boto){
    var divSortida=id_boto.split(' ')[1];
    //console.log(divSortida);
    var llistatTags = document.getElementById(divSortida).childNodes;
    var trs=getAllTRs(llistatTags);
    //console.log(trs);
    var llistatfiles=[];
    for(var i=0; i<trs.length; i++){
        llistatfiles.push(JSON.stringify(getJSONData(trs[i])));
    }
    if(document.getElementById(divSortida+"-OrdenacioPerEstatConservacio").value==='ordena'){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/ordenacio/',
            data:{
                'tipusOrdenacio': 'estatConservacio',
                'informacio' : JSON.stringify(llistatfiles),
                'sentit' : document.getElementById(divSortida+"-SentitOrdreEC").value
            },
            dataType:'json',
            success:
                function (data){
                    var data1 = Object.values(data);
                    crearGraella(data1.length, '', divSortida);
                    document.getElementById("textNumElems"+getNumResultat(divSortida).toString()).innerHTML="Nombre de resultats: "+data1.length;
                    for(var i=0; i<data1.length; i++){
                        let info_array = Object.values(data1[i]);
                        for(var j=1; j<info_array.length; j++){
                            console.log(info_array[j]);
                            if(j === 1){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, '<a href="'+info_array[j]+'" target="_blank" rel="noopener noreferrer">'+info_array[0]+'</a>')
                            }else if (j===3){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, estrelles(info_array[j], info_array[0]));
                            }else{
                                afegirInfoCasellaEspecifica(i+1,j,divSortida, info_array[j]);
                            }
                        }
                    }
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerEstatConservacio").value='NoOrdena';
        if(document.getElementById(divSortida+"-SentitOrdreEC").value=== 'descendent'){
            document.getElementById(divSortida+"-SentitOrdreEC").value= 'ascendent';
        }else{
            document.getElementById(divSortida+"-SentitOrdreEC").value='descendent';
        }
    }else{
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques/',
            data:{
                'poblacio' : document.getElementById('pobleSeleccionat').value,
                'actiu' : document.getElementById('estat').value,
                'categoria' : document.getElementById("categoriaSeleccionada").value
            },
            dataType:'json',
            success:
                function (data) {
                    tractamentDadesEstadistiques(data, 'estadistiques');
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerEstatConservacio").value='ordena';
    }
}
function ordenarPerAnyConstrucccio(id_boto){
    var divSortida=id_boto.split(' ')[1];
    //console.log(divSortida);
    var llistatTags = document.getElementById(divSortida).childNodes;
    var trs=getAllTRs(llistatTags);
    //console.log(trs);
    var llistatfiles=[];
    for(var i=0; i<trs.length; i++){
        llistatfiles.push(JSON.stringify(getJSONData(trs[i])));
    }
    if(document.getElementById(divSortida+"-OrdenacioPerAnyConstruccio").value==='ordena'){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/ordenacio/',
            data:{
                'tipusOrdenacio': 'anyConstruccio',
                'informacio' : JSON.stringify(llistatfiles),
                'sentit' : document.getElementById(divSortida+"-SentitOrdreAC").value
            },
            dataType:'json',
            success:
                function (data){
                    var data1 = Object.values(data);
                    crearGraella(data1.length, '', divSortida);
                    document.getElementById("textNumElems"+getNumResultat(divSortida).toString()).innerHTML="Nombre de resultats: "+data1.length;
                    for(var i=0; i<data1.length; i++){
                        let info_array = Object.values(data1[i]);
                        for(var j=1; j<info_array.length; j++){
                            console.log(info_array[j]);
                            if(j === 1){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, '<a href="'+info_array[j]+'" target="_blank" rel="noopener noreferrer">'+info_array[0]+'</a>')
                            }else if (j===3){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, estrelles(info_array[j], info_array[0]));
                            }else{
                                afegirInfoCasellaEspecifica(i+1,j,divSortida, info_array[j]);
                            }
                        }
                    }
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerAnyConstruccio").value='NoOrdena';
        if(document.getElementById(divSortida+"-SentitOrdreAC").value=== 'descendent'){
            document.getElementById(divSortida+"-SentitOrdreAC").value= 'ascendent';
        }else{
            document.getElementById(divSortida+"-SentitOrdreAC").value='descendent';
        }
    }else{
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques/',
            data:{
                'poblacio' : document.getElementById('pobleSeleccionat').value,
                'actiu' : document.getElementById('estat').value,
                'categoria' : document.getElementById("categoriaSeleccionada").value
            },
            dataType:'json',
            success:
                function (data) {
                    tractamentDadesEstadistiques(data, 'estadistiques');
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerAnyConstruccio").value='ordena';
    }
}
function ordenarPerLocalitat(id_boto){
    var divSortida=id_boto.split(' ')[1];
    //console.log(divSortida);
    var llistatTags = document.getElementById(divSortida).childNodes;
    var trs=getAllTRs(llistatTags);
    //console.log(trs);
    var llistatfiles=[];
    for(var i=0; i<trs.length; i++){
        llistatfiles.push(JSON.stringify(getJSONData(trs[i])));
    }
    if(document.getElementById(divSortida+"-OrdenacioPerLocalitat").value==='ordena'){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/ordenacio/',
            data:{
                'tipusOrdenacio': 'localitat',
                'informacio' : JSON.stringify(llistatfiles),
                'sentit':document.getElementById(divSortida+"-SentitOrdreL").value
            },
            dataType:'json',
            success:
                function (data){
                    var data1 = Object.values(data);
                    crearGraella(data1.length, '', divSortida);
                    document.getElementById("textNumElems"+getNumResultat(divSortida).toString()).innerHTML="Nombre de resultats: "+data1.length;
                    for(var i=0; i<data1.length; i++){
                        let info_array = Object.values(data1[i]);
                        for(var j=1; j<info_array.length; j++){
                            console.log(info_array[j]);
                            if(j === 1){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, '<a href="'+info_array[j]+'" target="_blank" rel="noopener noreferrer">'+info_array[0]+'</a>')
                            }else if (j===3){
                                afegirInfoCasellaEspecifica(i+1, j, divSortida, estrelles(info_array[j], info_array[0]));
                            }else{
                                afegirInfoCasellaEspecifica(i+1,j,divSortida, info_array[j]);
                            }
                        }
                    }
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerLocalitat").value='NoOrdena';
        if(document.getElementById(divSortida+"-SentitOrdreL").value ==='descendent'){
            document.getElementById(divSortida+"-SentitOrdreL").value = 'ascendent';
        }else{
            document.getElementById(divSortida+"-SentitOrdreL").value='descendent';
        }
    }else{
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/estadistiques/',
            data:{
                'poblacio' : document.getElementById('pobleSeleccionat').value,
                'actiu' : document.getElementById('estat').value,
                'categoria' : document.getElementById("categoriaSeleccionada").value
            },
            dataType:'json',
            success:
                function (data) {
                    tractamentDadesEstadistiques(data, 'estadistiques');
                }
        });
        document.getElementById(divSortida+"-OrdenacioPerLocalitat").value='ordena';
    }
}

</script>
</body>