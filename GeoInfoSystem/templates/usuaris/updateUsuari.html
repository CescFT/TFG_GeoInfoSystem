{% extends 'home/base.html' %}
{% block title %} Modificació del perfil - {{ user.username }}{% endblock %}
{% block content %}
<body>
<br>
<h1 class="text-center">Actualització dels camps</h1>
<hr>
<div class="container">
    {%if chMail %}
    <h2>Canvi de correu electrònic</h2>
    <p style="margin-left: 25px">En el següent formulari tens la oportunitat de canviar o afegir el correu electrònic del teu perfil</p>
    <div style="display: block; margin-left: auto; margin-right: auto; width: 40%;">
        <div class="form-group border p-3">
            <div id="errorsMail"></div>
            <br>
            <form id="form_update_mail" method="POST" action="/v1/geoInfoSystem/actualitzar_camps/actualitzaMail/">
                {% csrf_token %}
                <div class="form-group">
                    <div class="row">
                        <div class="col-sm">
                            <label><b>Nou correu electrònic:</b></label>
                        </div>
                        <div class="col-sm">
                            <input type="email" id="mail" name="email"  onkeyup="checkEmptyMails()" placeholder="correu@exemple.com" required>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-sm">
                            <label><b>Repeteix el correu electrònic:</b></label>
                        </div>
                        <div class="col-sm">
                            <input type="email"  id="mail1" name="email1" onkeyup="checkEmptyMails()" placeholder="correu@exemple.com" required>
                        </div>
                    </div>
                </div>
            </form>
            <div class="text-center"><button type="submit" name="submit_update" onclick="checkMails()" id="bttn_update_mail" class="btn btn-success" disabled><i class="fa fa-edit"></i> Actualitza el correu</button></div>
        </div>
    </div>

{%elif chNom %}
    <h1>Canvi de nom</h1>
    <p>En el següent formulari tens la oportunitat d'afegir el nom</p>
    <div id="errorsNom"></div>
<form id="form_update_nom" method="POST" action="/v1/geoInfoSystem/actualitzar_camps/actualitzaNom/">
    {% csrf_token %}
    <div><p>Nou nom:</p></div>
    <input type="text" id="first_name"  onkeyup="checkEmptyNames()" name="first_name" placeholder="Nom" required>
    <div><p>Repeteix el nou Nom:</p></div>
    <input type="text" id="first_name1" onkeyup="checkEmptyNames()" name="first_name1" placeholder="Repeteix nom" required>
</form>
<button type="submit"  name="submit_update" onclick="checkNames()" id="bttn_update_name" class="btn btn-success" disabled>Actualitza el nom</button>



{%elif chCog %}
    <h1>Canvi de cognom</h1>
    <p>En el següent formulari tens la oportunitat d'afegir els cognoms</p>
    <div id="errorsCognom"></div>
<form id="form_update_cognom" method="POST" action="/v1/geoInfoSystem/actualitzar_camps/actualitzaCognom/">
    {% csrf_token %}
    <div><p>Nou cognom:</p></div>
    <input type="text"  id="last_name"  onkeyup="checkEmptySurnames()"  name="last_name" placeholder="Cognom" required>
    <div><p>Repeteix el nou cognom:</p></div>
    <input type="text"  id="last_name1" onkeyup="checkEmptySurnames()"  name="last_name1" placeholder="Repeteix cognom" required>
</form>
<button type="submit" name="submit_update"  onclick="checkSurnames()"  id="bttn_update_surname" class="btn btn-success" disabled>Actualitza el Cognom</button>




{%elif chPass %}
    <h1>Canvi de contrassenya</h1>
    <p>En el següent formulari tens la oportunitat de canviar la contrassenya</p>
    <div id="errorsContrassenya"></div>
<form id="form_update_contrassenya" method="POST" action="/v1/geoInfoSystem/actualitzar_camps/actualitzaContrassenya/">
    {% csrf_token %}
    <div><p>Nova contrassenya:</p></div>
    <input type="password" id="password" onkeyup="checkEmptyPasswd()" name="password" placeholder="Contrassenya" required>
    <div><p>Repeteix la nova contrassenya:</p></div>
    <input type="password" id="password1" onkeyup="checkEmptyPasswd()" name="password1" placeholder="Repeteix contrassenya" required>
</form>
<button type="submit" name="submit_update" onclick="checkPasswd()" id="bttn_update_password" class="btn btn-success" disabled>Canvia la contrassenya</button>
{%endif%}
</div>





<script>
    function checkEmptyMails(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_mails_buits_update/',
            data:{
                'mail1' : document.getElementById("mail").value,
                'mail2' : document.getElementById("mail1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='true'){
                        document.getElementById("bttn_update_mail").disabled=false;
                    }else{
                        document.getElementById("bttn_update_mail").disabled=true;
                    }
                }
        });
    }
    function checkMails(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_mails_update/',
            data:{
                'mail1' :  document.getElementById("mail").value,
                'mail2' : document.getElementById("mail1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='false'){
                        document.getElementById("errorsMail").innerHTML='Els dos camps no coincideixen o no té format mail.';
                        document.getElementById("errorsMail").style.color="red";
                    }else{
                        document.getElementById("form_update_mail").submit();
                    }
                }
        });
    }

    function checkEmptyNames(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_noms_buits_update/',
            data:{
                'nom1' : document.getElementById("first_name").value,
                'nom2' : document.getElementById("first_name1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='true'){
                        document.getElementById("bttn_update_name").disabled=false;
                    }else{
                        document.getElementById("bttn_update_name").disabled=true;
                    }
                }
        });
    }
    function checkNames(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_noms_update/',
            data:{
                'nom1' :  document.getElementById("first_name").value,
                'nom2' : document.getElementById("first_name1").value,
                'nomUsuari': `{{user.username}}`
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='false'){
                        document.getElementById("errorsNom").innerHTML='Els dos camps no coincideixen o el nom coincideix amb el nom d\'usuari.';
                        document.getElementById("errorsNom").style.color="red";
                    }else{
                        document.getElementById("form_update_nom").submit();
                    }
                }
        });
    }

    function checkEmptySurnames(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_cognoms_buits_update/',
            data:{
                'cognom1' : document.getElementById("last_name").value,
                'cognom2' : document.getElementById("last_name1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='true'){
                        document.getElementById("bttn_update_surname").disabled=false;
                    }else{
                        document.getElementById("bttn_update_surname").disabled=true;
                    }
                }
        });
    }
    function checkSurnames(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_cognoms_update/',
            data:{
                'cognom1' :  document.getElementById("last_name").value,
                'cognom2' : document.getElementById("last_name1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='false'){
                        document.getElementById("errorsCognom").innerHTML='Els dos camps no coincideixen.';
                        document.getElementById("errorsCognom").style.color="red";
                    }else{
                        document.getElementById("form_update_cognom").submit();
                    }
                }
        });
    }

    function checkEmptyPasswd(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_contrassenya_buits_update/',
            data:{
                'passwd1' : document.getElementById("password").value,
                'passwd2' : document.getElementById("password1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='true'){
                        document.getElementById("bttn_update_password").disabled=false;
                    }else{
                        document.getElementById("bttn_update_password").disabled=true;
                    }
                }
        });
    }
    function checkPasswd(){
        $.ajax({
            type: 'GET',
            url : '/v1/geoInfoSystem/comprovar_contrassenya_update/',
            data:{
                'passwd1' :  document.getElementById("password").value,
                'passwd2' : document.getElementById("password1").value
            },
            dataType:'json',
            success:
                function (data){
                    var info = Object.values(data)[0];
                    if(info ==='false'){
                        document.getElementById("errorsContrassenya").innerHTML='Els dos camps no coincideixen o no hi ha més de 8 caràcters.';
                        document.getElementById("errorsContrassenya").style.color="red";
                    }else{
                        document.getElementById("form_update_contrassenya").submit();
                    }
                }
        });
    }

</script>
</body>
{%endblock%}